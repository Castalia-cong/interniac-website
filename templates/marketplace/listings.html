<div class="mt-5" id="listings">

    {% for listing in object_list %}
        <div class="listing-card mb-5">
            <div class="container-fluid mt-3 mb-3">
                <div class="row">
                    <div class="col-lg-8">
                        <p>{{ listing.title }}</p>
                    </div>
                    <div class="col-lg-1">
                        <img class="img-fluid" src="{{ listing.company.profile_picture.url }}" alt="company logo"/>
                    </div>
                    {% if user.is_student %}
                        <div class="col-lg-3 text-right">
                            {% if listing in user.applications.all %}
                                <button onclick="unapply({{ listing.id }}, this)">Unapply</button>
                            {% else %}
                                <button onclick="apply({{ listing.id }}, this)">Apply</button>
                            {% endif %}
                        </div>
                    {% endif %}

                </div>
                <p style="line-height: 0">{{ listing.company.company_name }}</p>
                {% if listing.type == "paid" %}
                    <p>paid -
                        {% if listing.where == 'in-person' %}
                            in person
                        {% else %}
                            virtual
                            </p>
                        {% endif %}
                {% else %}
                    <p>unpaid -
                        {% if listing.where == 'in-person' %}
                            in person
                        {% else %}
                            virtual
                            </p>
                        {% endif %}
                {% endif %}
                <p class="text-muted">{{ listing.description|truncatechars:500 }}</p>
                <div class="row justify-content-end">
                    <a href="{{ listing.get_absolute_url }}">View</a>
                </div>
            </div>
        </div>

    {% empty %}
        <h1 class="alert-danger text-center mt-3">No results</h1>
    {% endfor %}
</div>

<script type="text/javascript">
    function apply(id, el) {
        $.ajax({
            type: 'get',
            url: `apply/${id}`,
            success: function (data) {
                $(el).replaceWith(data);
            },
            error: function (_) {
                $(el).html("Something went wrong!");
            }
        })
    }

    function unapply(id, el) {
        $.ajax({
            type: 'get',
            url: `unapply/${id}`,
            success: function (data) {
                $(el).replaceWith(data);
            },
            error: function (_) {
                $(el).html("Something went wrong!");
            }
        })
    }
</script>
